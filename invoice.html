<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8">
  <title>H√≥a ƒë∆°n b√°n h√†ng</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      padding: 20px;
    }
    .toolbar {
      margin-bottom: 20px;
    }
    .toolbar button {
      margin-right: 10px;
      padding: 8px 16px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 14px;
    }
    .print-btn { background: #4caf50; color: white; }
    .pdf-btn   { background: #2196f3; color: white; }
    #invoice {
      background: white;
      padding: 20px;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      width: 600px;
      margin: auto;
    }
  </style>
  <!-- Th∆∞ vi·ªán html2pdf -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
</head>
<body>
  <div class="toolbar">
    <button class="print-btn" onclick="window.print()">üñ®Ô∏è Print Preview</button>
    <button class="pdf-btn" onclick="exportPDF()">üìÑ Export PDF</button>
  </div>

  <!-- N·ªôi dung h√≥a ƒë∆°n -->
  <div id="invoice">
    <h2 style="text-align:center">H√ìA ƒê∆†N B√ÅN H√ÄNG</h2>
    <p>M√£ h√≥a ƒë∆°n: <span id="idhd"></span></p>
    <p>Kh√°ch h√†ng: <span id="tenkh"></span></p>
    <p>Th·ªùi gian: <span id="time"></span></p>

    <table border="1" width="100%" cellspacing="0" cellpadding="5">
      <thead>
        <tr>
          <th>T√™n h√†ng</th>
          <th>SL</th>
          <th>ƒê∆°n gi√°</th>
          <th>Th√†nh ti·ªÅn</th>
        </tr>
      </thead>
      <tbody id="items"></tbody>
    </table>

    <h3 style="text-align:right">T·ªïng c·ªông: <span id="total"></span></h3>
    <p style="text-align:right"><i><span id="texttotal"></span></i></p>

    <div style="text-align:center; margin-top:20px">
      <img id="qr" src="" alt="QR Thanh to√°n" style="width:150px; height:150px">
    </div>
  </div>

  <script>
    // H√†m export PDF
    function exportPDF() {
      const element = document.getElementById('invoice');
      const opt = {
        margin:       0.5,
        filename:     'invoice.pdf',
        image:        { type: 'jpeg', quality: 0.98 },
        html2canvas:  { scale: 2 },
        jsPDF:        { unit: 'in', format: 'a4', orientation: 'portrait' }
      };
      html2pdf().set(opt).from(element).save();
    }

    // Parse URL params v√† render d·ªØ li·ªáu
    const params = new URLSearchParams(window.location.search);
    document.getElementById('idhd').innerText = params.get('id');
    document.getElementById('tenkh').innerText = params.get('tenkh');
    document.getElementById('time').innerText = params.get('time');
    document.getElementById('total').innerText = params.get('total');
    document.getElementById('texttotal').innerText = params.get('texttotal');
    document.getElementById('qr').src = params.get('img');

    // Items: d·∫°ng "T√™n|SL|ƒê∆°n gi√°|Th√†nh ti·ªÅn;..."
    const items = params.get('items')?.split(";") || [];
    const tbody = document.getElementById('items');
    items.forEach(row => {
      const [ten, sl, gia, tien] = row.split("|");
      if (ten) {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${ten}</td><td>${sl}</td><td>${gia}</td><td>${tien}</td>`;
        tbody.appendChild(tr);
      }
    });
  </script>
</body>
</html>
