<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>PHI·∫æU T√çNH TI·ªÄN</title>
  <style>
    :root { --maxw: 480px; }
    body { font-family: Arial, sans-serif; margin:0; background:#fff; }
    .wrap { max-width: var(--maxw); margin: 16px auto; padding: 16px 18px; border:1px solid #000; }
    .head { display:flex; gap:12px; align-items:center; }
    .head img { width:64px; height:auto; }
    .shop { line-height:1.25; }
    .shop b { font-size:18px; }
    h1 { text-align:center; margin:18px 0 8px; font-size:24px; letter-spacing:1px; }
    .info p { margin:4px 0; font-size:14px; }
    table { width:100%; border-collapse:collapse; font-size:14px; margin-top:12px; }
    th, td { border:1px solid #000; padding:6px 8px; text-align:center; }
    th { background:#f2f2f2; }
    td.tl { text-align:left; }
    td.tr { text-align:right; }
    .sum { margin-top:10px; font-size:15px; }
    .sum p { margin:6px 0; }
    .qr { text-align:center; margin:16px 0 6px; }
    .qr img { width:180px; height:auto; }
    .foot { text-align:center; font-size:14px; margin-top:10px; font-style:italic; }
    @media (max-width: 520px) { .wrap { margin:0; border:none; } }
    @media print { body{ background:#fff } .wrap{ border:none; margin:0; } }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <img src="https://i.ibb.co/HDGQyJBw/1-Logo-100358.jpg" alt="Logo" />
      <div class="shop">
        <b>HUONG DO PICKLEBALL</b><br/>
        118 L√≤ Chum, P. H·∫°c Th√†nh, t·ªânh Thanh H√≥a
      </div>
    </div>

    <h1>PHI·∫æU T√çNH TI·ªÄN</h1>

    <div class="info">
      <p><b>S·ªë giao d·ªãch:</b> <span id="id"></span></p>
      <p><b>Ng√†y, gi·ªù:</b> <span id="time"></span></p>
      <p><b>T√™n Kh√°ch h√†ng:</b> <span id="cust"></span></p>
      <p><b>Gi·ªù b·∫Øt ƒë·∫ßu:</b> <span id="start"></span></p>
      <p><b>Gi·ªù k·∫øt th√∫c:</b> <span id="end"></span></p>
    </div>

    <table>
      <thead>
        <tr>
          <th style="width:46%">D·ªãch v·ª•</th>
          <th style="width:10%">SL</th>
          <th style="width:22%">ƒê∆°n gi√°</th>
          <th style="width:22%">Th√†nh ti·ªÅn</th>
        </tr>
      </thead>
      <tbody id="tbody"></tbody>
    </table>

    <div class="sum">
      <p><b>T·ªïng c·ªông:</b> <span id="total"></span> ƒë</p>
      <p><b>B·∫±ng ch·ªØ:</b> <span id="totalText"></span></p>
    </div>

<div class="qr">
  <h3>Qu√©t m√£ ƒë·ªÉ thanh to√°n</h3>
  <img id="qr" alt="VietQR" />
</div>

<script>
  // H√†m l·∫•y query string t·ª´ URL
  function getQueryParam(name) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(name) || "";
  }

  // L·∫•y d·ªØ li·ªáu c·∫ßn cho QR (v√≠ d·ª• t·ªïng ti·ªÅn + id giao d·ªãch)
  const id = getQueryParam("id");
  const total = getQueryParam("total");
  const tenkh = getQueryParam("tenkh");

  // üîë V√≠ d·ª•: VietQR v·ªõi BIDV (970418) v√† s·ªë t√†i kho·∫£n gi·∫£ ƒë·ªãnh
  // B·∫°n thay s·ªë t√†i kho·∫£n / ng√¢n h√†ng th·∫≠t c·ªßa m√¨nh
  const bankBin = "970418"; // M√£ BIN ng√¢n h√†ng (VD: BIDV)
  const accountNo = "123456789"; // S·ªë t√†i kho·∫£n nh·∫≠n
  const accountName = "NGUYEN VAN A"; // T√™n ch·ªß t√†i kho·∫£n
  const amount = total || "0";
  const addInfo = "Thanh toan don hang " + id;

  // API t·∫°o QR t·ª´ VietQR.io
  const qrUrl = `https://img.vietqr.io/image/${bankBin}-${accountNo}-compact.png?amount=${amount}&addInfo=${encodeURIComponent(addInfo)}&accountName=${encodeURIComponent(accountName)}`;

  // G√°n v√†o th·∫ª img
  document.getElementById("qr").src = qrUrl;
</script>


    <div class="foot">
      <p><b><i>Qu√Ω kh√°ch vui l√≤ng gi·ªØ l·∫°i phi·∫øu t√≠nh ti·ªÅn</i></b></p>
      <p><b><i>Xin c·∫£m ∆°n v√† h·∫πn g·∫∑p l·∫°i!</i></b></p>
      <p><b><i>C·∫£m ∆°n khi ti·∫øp nh·∫≠n ph·∫£n h·ªìi c·ªßa qu√Ω kh√°ch.</i></b></p>
    </div>
  </div>

<script>
  const qp = new URLSearchParams(location.search);
  const get = k => qp.get(k) || "";

  // ---- helpers ----
  const toNumber = v => {
    if (typeof v === "number") return v;
    let s = String(v || "").trim();
    // b·ªè m·ªçi k√Ω t·ª± kh√¥ng ph·∫£i s·ªë (VND kh√¥ng d√πng th·∫≠p ph√¢n)
    s = s.replace(/[^\d-]/g, "");
    return s ? parseInt(s, 10) : 0;
  };
  const fmt = n => Number(n || 0).toLocaleString("vi-VN");

  // ---- info ----
  document.getElementById("id").textContent = get("id");
  document.getElementById("time").textContent = get("time");
  document.getElementById("cust").textContent = get("tenkh") || get("customer") || "";
  document.getElementById("start").textContent = get("start");
  document.getElementById("end").textContent = get("end");

  // ---- items: h·ªó tr·ª£ 2 ki·ªÉu truy·ªÅn ----
  // A) items=Ten|SL|DonGia;Ten|SL|DonGia;...
  // B) hang=a;b;c  & soluong=1;2;3 & gia=10000;20000;...
  const tbody = document.getElementById("tbody");
  let rows = [];

  const itemsParam = get("items");
  if (itemsParam) {
    // URLSearchParams ƒë√£ decode ‚Üí kh√¥ng decode l·∫ßn n·ªØa
    itemsParam.split(";").forEach(one => {
      if (!one) return;
      const parts = one.split("|");
      const name = (parts[0] || "").trim();
      const qty  = toNumber(parts[1]);
      const price= toNumber(parts[2]);
      rows.push({ name, qty, price });
    });
  } else {
    const splitList = s => !s ? [] : (s.includes(";") ? s.split(";") : s.split(",")).map(x=>x.trim());
    const names = splitList(get("hang"));
    const qtys  = splitList(get("soluong"));
    const prices= splitList(get("gia"));
    const n = Math.max(names.length, qtys.length, prices.length);
    for (let i = 0; i < n; i++) {
      const name = names[i] || "";
      const qty  = toNumber(qtys[i]);
      const price= toNumber(prices[i]);
      if (name || qty || price) rows.push({ name, qty, price });
    }
  }

  // ---- render + t√≠nh t·ªïng ----
  let grand = 0;
  tbody.innerHTML = rows.map(r => {
    const line = (r.qty || 0) * (r.price || 0);
    grand += line;
    return `<tr>
      <td class="tl">${r.name}</td>
      <td>${r.qty || 0}</td>
      <td class="tr">${fmt(r.price)}</td>
      <td class="tr">${fmt(line)}</td>
    </tr>`;
  }).join("");

  // t·ªïng c·ªông (∆∞u ti√™n s·ªë truy·ªÅn v√†o, n·∫øu kh√¥ng c√≥ s·∫Ω d√πng s·ªë t√≠nh)
  const totalParam = toNumber(get("total"));
  const total = totalParam > 0 ? totalParam : grand;
  document.getElementById("total").textContent = fmt(total);

  // b·∫±ng ch·ªØ (n·∫øu truy·ªÅn)
  document.getElementById("totalText").textContent = get("texttotal") || get("bangchu") || "";

  // QR
  const qr = get("qr");
  if (qr) document.getElementById("qr").src = qr;
</script>
</body>
</html>


