<script>
async function fetchData() {
  const url = 'https://docs.google.com/spreadsheets/d/17l3xrP5q_5miTrFEsp5VFU880oS9Kx6lOe2qfSEBwQQ/gviz/tq?sheet=HIENTHI1';
  try {
    const res = await fetch(url);
    const text = await res.text();
    const json = JSON.parse(text.substring(47, text.length - 2));
    renderTable(json.table.rows);
  } catch (err) {
    document.getElementById("table").innerHTML = "❌ Không tải được dữ liệu";
  }
}

function renderTable(rows) {
  if (!rows || rows.length === 0) {
    document.getElementById("table").innerHTML = "⚠️ Không có dữ liệu từ Sheet";
    return;
  }

  console.log(rows); // Kiểm tra cấu trúc để xác nhận

  // Dòng 1: tên vòng
  const vong = rows[0]?.c?.find(c => c?.v)?.v || "VÒNG LOẠI";
  // Dòng 2: tên giải
  const tenGiai = rows[1]?.c?.find(c => c?.v)?.v || "PICKLEBALL MIXED POWER CUP 4.8";
  // Dòng 3: kết quả
  const r = rows.find(row => row?.c?.some(c => c?.v && c.v.toString().includes("VS") === false)) || rows[2];

  if (!r || !r.c) {
    document.getElementById("table").innerHTML = "⚠️ Thiếu dữ liệu hiển thị";
    return;
  }

  // Dò dữ liệu theo cột
  const vals = r.c.map(c => c?.v || "");
  const [dot, diem1, doi1, , doi2, diem2] = vals;

  let html = `
    <table>
      <tr><td colspan="7" class="vongloai">${vong}</td></tr>
      <tr><td colspan="7" class="tengiai">${tenGiai}</td></tr>
      <tr class="ketqua">
        <td class="dot">${dot}</td>
        <td class="score">${diem1}</td>
        <td class="team">${doi1}</td>
        <td class="vs"><img src="https://i.ibb.co/6RRh9rr/vs.png" width="60"></td>
        <td class="team">${doi2}</td>
        <td class="score">${diem2}</td>
        <td class="logo"><img src="https://i.ibb.co/XwPyvS5/1-Logo-100358.jpg"></td>
      </tr>
    </table>
  `;

  document.getElementById("table").innerHTML = html;
}

fetchData();
setInterval(fetchData, 5000);
</script>
