<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="utf-8" />
<title>K·∫øt qu·∫£ Pickleball</title>
<link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">
<style>
  body{margin:0;font-family:'Lexend',sans-serif;background:#fff;color:#222}
  .header-green{background:#28a745;color:#fff;padding:14px;text-align:center;font-weight:800;border-top-left-radius:20px;border-top-right-radius:20px}
  .header-gray{background:#555;color:#fff;padding:12px;text-align:center;font-weight:800}
  .container{max-width:1200px;margin:12px auto;padding:8px;border-radius:20px;box-shadow:0 4px 8px rgba(0,0,0,0.15)}
  .match{display:flex;align-items:center;justify-content:center;gap:20px;padding:20px}
  .score{font-size:64px;color:#a40000;font-weight:900;width:90px;text-align:center}
  .team{font-size:28px;color:#FF8C00;font-weight:900;text-transform:uppercase;width:420px;text-align:center}
  .vs{font-size:36px;color:#FFB400;font-weight:900;text-shadow:1px 1px 0 #000}
  .dot{width:36px;height:36px;border-radius:50%;background:red;border:3px solid #000;display:none}
  .logo{position:absolute;left:16px;top:8px}
  .logo img{width:72px;height:72px;border-radius:50%}
</style>
</head>
<body>
  <div class="logo"><img src="https://i.ibb.co/XwPyvS5/1-Logo-100358.jpg" alt="logo"></div>
  <div id="hdr1" class="header-green">ƒêANG T·∫¢I D·ªÆ LI·ªÜU...</div>
  <div id="hdr2" class="header-gray">&nbsp;</div>

  <div class="container">
    <div id="matchArea" class="match">
      <div id="dot1" class="dot"></div>
      <div id="score1" class="score">0</div>
      <div id="team1" class="team">---</div>
      <div class="vs">VS</div>
      <div id="team2" class="team">---</div>
      <div id="score2" class="score">0</div>
      <div id="dot2" class="dot"></div>
    </div>
  </div>

<script>
/*
  Phi√™n b·∫£n hi·ªÉn th·ªã 1 tr·∫≠n duy nh·∫•t
  - D√≤ng 1, c·ªôt C: t√™n v√≤ng
  - D√≤ng 2, c·ªôt C: t√™n gi·∫£i
  - D√≤ng 3 tr·ªü ƒëi: d·ªØ li·ªáu tr·∫≠n ƒë·∫•u
  - C·ªôt A/G: ƒë·ªôi ƒëang giao b√≥ng (üî¥)
*/

// C·∫•u h√¨nh link sheet
const SHEET_ID = "17l3xrP5q_5miTrFEsp5VFU880oS9Kx6lOe2qfSEBwQQ";
const SHEET_NAME = "HIENTHI1";
const GID = "1034622929";

const GVIZ_URL = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tq=&sheet=${encodeURIComponent(SHEET_NAME)}&headers=0`;
const CSV_URL  = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/export?format=csv&gid=${GID}`;

function showError(title, msg){
  document.getElementById('hdr1').innerText = title;
  document.getElementById('hdr2').innerText = msg;
}

function safe(v){return v===undefined||v===null?"":String(v);}

function parseGviz(text){
  const start=text.indexOf('{');const end=text.lastIndexOf('}');
  if(start<0||end<0) throw new Error("Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c JSON GVIZ");
  return JSON.parse(text.substring(start,end+1));
}

async function loadData(){
  try{
    let txt = await fetch(GVIZ_URL).then(r=>r.text());
    const json = parseGviz(txt);
    const rows = json.table.rows || [];

    if(rows.length<3){
      showError("L·ªñI D·ªÆ LI·ªÜU","Kh√¥ng ƒë·ªß d·ªØ li·ªáu (ph·∫£i c√≥ √≠t nh·∫•t 3 d√≤ng)");
      return;
    }

    const vong = safe(rows[0]?.c?.[2]?.v);
    const giai = safe(rows[1]?.c?.[2]?.v);

    // ch·ªâ hi·ªÉn th·ªã tr·∫≠n ƒë·∫ßu ti√™n (d√≤ng 3)
    const cells = rows[2].c;
    const serveA = safe(cells[0]?.v);
    const score1 = safe(cells[1]?.v) || "0";
    const team1  = safe(cells[2]?.v) || "---";
    const team2  = safe(cells[4]?.v) || "---";
    const score2 = safe(cells[5]?.v) || "0";
    const serveG = safe(cells[6]?.v);

    document.getElementById("hdr1").innerText = vong || "TR·ª∞C TI·∫æP";
    document.getElementById("hdr2").innerText = giai || "";

    document.getElementById("score1").innerText = score1;
    document.getElementById("team1").innerText  = team1;
    document.getElementById("team2").innerText  = team2;
    document.getElementById("score2").innerText = score2;

    const dot1=document.getElementById("dot1");
    const dot2=document.getElementById("dot2");
    dot1.style.display=dot2.style.display="none";
    if(serveA) dot1.style.display="block";
    else if(serveG) dot2.style.display="block";

  }catch(err){
    showError("L·ªñI K·∫æT N·ªêI","Kh√¥ng th·ªÉ l·∫•y d·ªØ li·ªáu t·ª´ Sheet");
    console.error(err);
  }
}

loadData();
setInterval(loadData, 5000);
</script>
</body>
</html>
