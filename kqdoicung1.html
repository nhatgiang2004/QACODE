<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="utf-8" />
  <title>Kết quả thi đấu</title>
  <link href="https://fonts.googleapis.com/css2?family=Lexend&display=swap" rel="stylesheet">
  <style>
    body { margin:0; padding:20px; font-family:'Lexend', sans-serif; background:#fff; color:#111; }
    .giai, .vong { text-align:center; font-weight:800; text-transform:uppercase; margin-bottom:8px; }
    .giai { font-size:26px; color:#333; }
    .vong { font-size:20px; color:#FF5722; }
    .match { display:flex; align-items:center; justify-content:center; gap:18px; margin-top:20px; }
    .team { font-size:22px; width:300px; text-align:center; font-weight:700; text-transform:uppercase; color:#FF8C00; }
    .score { font-size:50px; width:70px; text-align:center; font-weight:900; color:#a40000; }
    .dot { width:36px; height:36px; border-radius:50%; background:red; border:3px solid #000; display:none; }
    .vs { font-size:30px; font-weight:800; color:#555; width:80px; text-align:center; }
  </style>
</head>
<body>
  <div class="giai" id="tenGiai">Đang tải tên giải...</div>
  <div class="vong" id="tenVong">Đang tải vòng...</div>

  <div class="match">
    <div id="dot1" class="dot"></div>
    <div id="score1" class="score">0</div>
    <div id="team1" class="team">---</div>
    <div class="vs">VS</div>
    <div id="team2" class="team">---</div>
    <div id="score2" class="score">0</div>
    <div id="dot2" class="dot"></div>
  </div>

<script>
const SHEET_URL = "https://docs.google.com/spreadsheets/d/17l3xrP5q_5miTrFEsp5VFU880oS9Kx6lOe2qfSEBwQQ/gviz/tq?sheet=HIENTHI1";

async function loadData() {
  try {
    const res = await fetch(SHEET_URL);
    const text = await res.text();

    // Gviz trả về JSON nằm trong hàm JS, ta tách phần JSON thực
    const json = JSON.parse(text.match(/{.*}/s)[0]);
    const rows = json.table.rows;

    if (!rows || rows.length < 2) {
      document.getElementById("tenGiai").innerText = "Không đủ dữ liệu";
      return;
    }

    // ===== 2 dòng đầu =====
    const tenGiai = rows[0]?.c?.[0]?.v || "";
    const tenVong = rows[1]?.c?.[0]?.v || "";

    document.getElementById("tenGiai").innerText = tenGiai || "Tên giải đấu";
    document.getElementById("tenVong").innerText = tenVong || "Tên vòng";

    // ===== Dòng dữ liệu thi đấu (bắt đầu từ dòng 3 trở đi) =====
    const matchRow = rows[2];
    if (!matchRow || !matchRow.c) return;

    const c = matchRow.c.map(v => v ? v.v : "");

    // Giả định:
    // c[0] = chấm đỏ bên A (có giá trị nếu đang giao bóng)
    // c[1] = điểm đội A
    // c[2] = tên đội A
    // c[4] = tên đội B
    // c[5] = điểm đội B
    // c[6] = chấm đỏ bên G (có giá trị nếu đang giao bóng)

    document.getElementById("team1").innerText = c[2] || "---";
    document.getElementById("score1").innerText = c[1] ?? "0";
    document.getElementById("team2").innerText = c[4] || "---";
    document.getElementById("score2").innerText = c[5] ?? "0";

    // Chấm đỏ: cột A hoặc G có giá trị ⇒ hiển thị chấm đỏ tương ứng
    const dot1 = document.getElementById("dot1");
    const dot2 = document.getElementById("dot2");
    dot1.style.display = dot2.style.display = "none";
    if (c[0]) dot1.style.display = "block";
    if (c[6]) dot2.style.display = "block";

  } catch (err) {
    console.error(err);
    document.getElementById("tenGiai").innerText = "Lỗi dữ liệu!";
  }
}

loadData();
setInterval(loadData, 4000);
</script>
</body>
</html>
