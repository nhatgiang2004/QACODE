<div id="table"></div>

<script>
  function fetchData() {
    const url = 'https://docs.google.com/spreadsheets/d/16b_vb7G_4I-EmcWlzFIljJhmTWmiU9eybM126pMKNP0/gviz/tq?sheet=HIENTHI';

    fetch(url)
      .then(res => res.text())
      .then(rep => {
        const json = JSON.parse(rep.substring(47, rep.length - 2));
        renderTable(json.table);
      })
      .catch(err => {
        document.getElementById('table').innerHTML = "❌ Lỗi tải dữ liệu: " + err;
      });
  }

  function renderTable(table) {
    // Bỏ dòng đầu tiên (header)
    const rows = table.rows.slice(1);

    if (rows.length === 0) {
      document.getElementById('table').innerHTML = "⚠️ Sheet HIENTHI chưa có dữ liệu.";
      return;
    }

    let html = '<table border="1" cellspacing="0" cellpadding="5" style="border-collapse:collapse;text-align:left;">';

    if (rows.length >= 2) {
      // Có ít nhất 2 dòng -> gộp logo vào 2 dòng
      html += '<tr>';
      html += '<td rowspan="2" style="text-align:center;vertical-align:middle;">' +
              '<img src="https://i.ibb.co/XwPyvS5/1-Logo-100358.jpg" style="width:60px;height:auto;">' +
              '</td>';

      rows[0].c.slice(1).forEach(cell => {
        html += "<td>" + (cell && cell.v ? cell.v : "") + "</td>";
      });
      html += "</tr>";

      html += "<tr>";
      rows[1].c.slice(1).forEach(cell => {
        html += "<td>" + (cell && cell.v ? cell.v : "") + "</td>";
      });
      html += "</tr>";

      // Các dòng tiếp theo
      for (let i = 2; i < rows.length; i++) {
        html += "<tr><td></td>";
        rows[i].c.slice(1).forEach(cell => {
          html += "<td>" + (cell && cell.v ? cell.v : "") + "</td>";
        });
        html += "</tr>";
      }
    } else {
      // Trường hợp chỉ có 1 dòng dữ liệu
      html += '<tr>';
      html += '<td style="text-align:center;vertical-align:middle;">' +
              '<img src="https://i.ibb.co/XwPyvS5/1-Logo-100358.jpg" style="width:60px;height:auto;">' +
              '</td>';

      rows[0].c.slice(1).forEach(cell => {
        html += "<td>" + (cell && cell.v ? cell.v : "") + "</td>";
      });
      html += "</tr>";
    }

    html += "</table>";

    document.getElementById('table').innerHTML = html;
  }

  fetchData();
  setInterval(fetchData, 5000);
</script>
