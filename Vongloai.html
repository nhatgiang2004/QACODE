<!DOCTYPE html>
<html lang="vi">
<head>
  <meta charset="UTF-8" />
  <title>Bảng đấu từ Google Sheet</title>
  <style>
    table {
      border: 1px solid #333;
      border-collapse: collapse;
      width: 100%;
      margin-bottom: 20px;
    }
    th, td {
      border: 1px solid #333;
      padding: 6px;
      text-align: center;
    }
    thead th {
      background: #f0f0f0;
      font-weight: bold;
    }
    .match-container {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }
    .match {
      border: 2px solid #0077cc;
      padding: 10px;
      border-radius: 8px;
      flex: 1;
    }
    .match h3 {
      margin-top: 0;
      text-align: center;
    }
    .score-input {
      width: 40px;
      text-align: center;
    }
  </style>
</head>
<body>
  <h1>Bảng đấu (dữ liệu từ Google Sheets)</h1>
  <table id="sheetTable">
    <thead></thead>
    <tbody></tbody>
  </table>

  <h2>Các cặp đấu đã chọn</h2>
  <div class="match-container" id="selectedMatches"></div>

  <script>
    const url = 'https://docs.google.com/spreadsheets/d/16b_vb7G_4I-EmcWlzFIljJhmTWmiU9eybM126pMKNP0/gviz/tq?gid=37490152&tqx=out:json&tq=SELECT *';

    let sheetData = [];

    fetch(url)
      .then(response => response.text())
      .then(text => {
        const jsonText = text.substring(text.indexOf('{'), text.lastIndexOf('}')+1);
        const json = JSON.parse(jsonText);

        const cols = json.table.cols;
        const rows = json.table.rows;

        sheetData = rows.map(r => r.c.map(cell => (cell ? cell.v : "")));

        const thead = document.querySelector('#sheetTable thead');
        const tbody = document.querySelector('#sheetTable tbody');

        // ===== Header =====
        const trHead = document.createElement('tr');
        const thSelect = document.createElement('th');
        thSelect.textContent = "Chọn";
        trHead.appendChild(thSelect);

        cols.forEach(c => {
          const th = document.createElement('th');
          th.textContent = c.label || c.id;
          trHead.appendChild(th);
        });
        thead.appendChild(trHead);

        // ===== Body =====
        sheetData.forEach((row, idx) => {
          const tr = document.createElement('tr');

          // Checkbox
          const tdCheckbox = document.createElement('td');
          const checkbox = document.createElement('input');
          checkbox.type = "checkbox";
          checkbox.dataset.index = idx;
          checkbox.addEventListener("change", handleSelection);
          tdCheckbox.appendChild(checkbox);
          tr.appendChild(tdCheckbox);

          // Các ô dữ liệu
          row.forEach(cell => {
            const td = document.createElement('td');
            td.textContent = cell;
            tr.appendChild(td);
          });

          tbody.appendChild(tr);
        });
      })
      .catch(error => console.error('Lỗi khi fetch JSON:', error));

    function handleSelection() {
      const selectedIndexes = Array.from(document.querySelectorAll('#sheetTable tbody input[type="checkbox"]:checked'))
        .map(cb => parseInt(cb.dataset.index));

      const container = document.getElementById('selectedMatches');
      container.innerHTML = "";

      // chỉ hiển thị tối đa 2 cặp đấu
      selectedIndexes.slice(0, 2).forEach((idx, i) => {
        const row = sheetData[idx];
        // giả sử cột 0 = Đội 1, cột 1 = Đội 2
        const team1 = row[0] || "Đội A";
        const team2 = row[1] || "Đội B";

        const matchDiv = document.createElement('div');
        matchDiv.className = "match";
        matchDiv.innerHTML = `
          <h3>Cặp đấu ${i+1}</h3>
          <p>${team1} 
            <input class="score-input" type="number" min="0" value="0" id="score_${idx}_1"> 
            - 
            <input class="score-input" type="number" min="0" value="0" id="score_${idx}_2"> 
            ${team2}
          </p>
          <button onclick="updateResult(${idx})">Cập nhật kết quả</button>
          <div id="result_${idx}" style="margin-top:10px; font-weight:bold; color:#d00;"></div>
        `;
        container.appendChild(matchDiv);
      });
    }

    function updateResult(idx) {
      const score1 = document.getElementById(`score_${idx}_1`).value;
      const score2 = document.getElementById(`score_${idx}_2`).value;
      const row = sheetData[idx];
      const team1 = row[0] || "Đội A";
      const team2 = row[1] || "Đội B";

      let resultText = `${team1} ${score1} - ${score2} ${team2}`;
      document.getElementById(`result_${idx}`).textContent = "Kết quả: " + resultText;
    }
  </script>
</body>
</html>
